# =============================================================================
# Spooled Backend - Environment Configuration
# =============================================================================
# Copy this file to .env and update the values for your environment.
#
# For production deployments:
#   - Change ALL default passwords
#   - Generate a strong JWT_SECRET (at least 32 random characters)
#   - Use SSL connections for database and Redis
#   - Set RUST_ENV=production
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
HOST=0.0.0.0
PORT=8080
METRICS_PORT=9090

# Environment: development, staging, production
# In production/staging, stricter validation is enforced (JWT secret strength, etc.)
RUST_ENV=development

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------
# Connection via PgBouncer (recommended for production)
DATABASE_URL=postgres://spooled:spooled_password@localhost:6432/spooled

# Direct connection for migrations (bypasses PgBouncer)
DATABASE_DIRECT_URL=postgres://spooled:spooled_password@localhost:5432/spooled

# Connection pool settings
DATABASE_MAX_CONNECTIONS=25
DATABASE_MIN_CONNECTIONS=5
DATABASE_ACQUIRE_TIMEOUT_SECS=30

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
REDIS_URL=redis://localhost:6379
REDIS_POOL_SIZE=10

# -----------------------------------------------------------------------------
# JWT Authentication
# -----------------------------------------------------------------------------
# IMPORTANT: Change this in production!
# Must be at least 32 characters for production/staging.
# Generate with: openssl rand -base64 32
JWT_SECRET=development-secret-change-in-production
JWT_EXPIRATION_HOURS=24

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
RATE_LIMIT_REQUESTS_PER_SECOND=100
RATE_LIMIT_BURST_SIZE=200

# -----------------------------------------------------------------------------
# Worker Configuration
# -----------------------------------------------------------------------------
WORKER_HEARTBEAT_INTERVAL_SECS=10
WORKER_LEASE_DURATION_SECS=30
WORKER_MAX_CONCURRENCY=5
WORKER_FALLBACK_POLL_INTERVAL_SECS=5

# -----------------------------------------------------------------------------
# Queue Configuration
# -----------------------------------------------------------------------------
QUEUE_DEFAULT_MAX_RETRIES=3
QUEUE_DEFAULT_TIMEOUT_SECS=300
QUEUE_MAX_PAYLOAD_SIZE_BYTES=1048576

# -----------------------------------------------------------------------------
# Webhook Verification Secrets (Optional)
# -----------------------------------------------------------------------------
# GitHub webhook secret for verifying incoming GitHub webhooks
# GITHUB_WEBHOOK_SECRET=your-github-webhook-secret

# Stripe webhook secret for verifying incoming Stripe webhooks
# STRIPE_WEBHOOK_SECRET=whsec_your-stripe-webhook-secret

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
# Log levels: error, warn, info, debug, trace
RUST_LOG=spooled_backend=info,tower_http=info

# -----------------------------------------------------------------------------
# CORS Configuration (for browser clients)
# -----------------------------------------------------------------------------
# Comma-separated list of allowed origins (leave empty for restrictive default)
# CORS_ALLOWED_ORIGINS=https://app.yourdomain.com,https://admin.yourdomain.com

# -----------------------------------------------------------------------------
# Distributed Tracing (OpenTelemetry/Jaeger)
# -----------------------------------------------------------------------------
# To enable tracing, build with: cargo build --features otel
# OTLP endpoint for exporting traces (e.g., Jaeger)
# OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Service name for tracing (appears in Jaeger UI)
OTEL_SERVICE_NAME=spooled-backend

# Enable JSON structured logging (recommended for production)
JSON_LOGS=false
